<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Tokens Viewer</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; background: #f5f5f5; }
  h1 { text-align: center; margin-bottom: 1rem; }
  input[type="file"] { display: block; margin: 1rem auto; }
  .token-list { margin-top: 1rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem; }
  .token { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .token-name { font-weight: bold; margin-bottom: 0.5rem; word-break: break-all; }
  .token-value { font-family: monospace; color: #333; }
  .color-preview { width: 100%; height: 30px; border-radius: 4px; margin-top: 0.5rem; border: 1px solid #ccc; }
</style>
</head>
<body>
<h1>Design Tokens Viewer</h1>
<input type="file" id="yamlFile" accept=".yaml,.yml">
<div class="token-list" id="tokenList"></div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
const yamlFileInput = document.getElementById('yamlFile');
const tokenList = document.getElementById('tokenList');

yamlFileInput.addEventListener('change', (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const yamlText = e.target.result;
      const data = jsyaml.load(yamlText);
      displayTokens(data);
    } catch (err) {
      alert('Error parsing YAML: ' + err.message);
    }
  };
  reader.readAsText(file);
});

// Flatten nested objects like defaults.cx-color-primary
function flatten(obj, parentKey = '', res = {}) {
  for (const key in obj) {
    const value = obj[key];
    const newKey = parentKey ? `${parentKey}.${key}` : key;
    if (typeof value === 'object' && value !== null) {
      flatten(value, newKey, res);
    } else {
      res[newKey] = value;
    }
  }
  return res;
}

// Extract color literal from the YAML value string
function extractColor(value) {
  if (typeof value !== 'string') return null;
  // Match "#xxxxxx", "#xxx" or "rgba(...)"
  const match = value.match(/#([0-9A-Fa-f]{3,6})|rgba?\([^)]+\)/);
  return match ? match[0] : null;
}

function displayTokens(data) {
  tokenList.innerHTML = '';
  if (!data.defaults) return;

  const flatTokens = flatten(data.defaults);

  for (const key in flatTokens) {
    let value = flatTokens[key];

    // Remove YAML anchor (&cx-color-primary ...) if present
    value = value.replace(/^&[^ ]+ /, '').replace(/^['"]|['"]$/g, '').trim();

    const tokenDiv = document.createElement('div');
    tokenDiv.classList.add('token');

    const nameEl = document.createElement('div');
    nameEl.classList.add('token-name');
    nameEl.textContent = key;

    const valueEl = document.createElement('div');
    valueEl.classList.add('token-value');
    valueEl.textContent = value;

    tokenDiv.appendChild(nameEl);
    tokenDiv.appendChild(valueEl);

    const color = extractColor(value);
    if (color) {
      const colorBox = document.createElement('div');
      colorBox.classList.add('color-preview');
      colorBox.style.backgroundColor = color;
      tokenDiv.appendChild(colorBox);
    }

    tokenList.appendChild(tokenDiv);
  }
}
</script>
</body>
</html>